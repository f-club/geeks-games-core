//
//
//

const db = require('db');
const Player = require('core/player');
const uuid = require('core/uuid/create');


function add(data = {}, cb) {

  cb = cb || function() {};

  if (!data.username) {
    return cb({
      status: 400,
      err: new Error('low args')
    })
  }

  Player.exists(data.username, function(err, exists) {
    if (err) {
      return cb(err);
    }

    if (exists) {
      return cb(null, false, {
        exists: true
      });
    }

    save_user(data, function(err, player_data) {
      if (err) {
        return cb(err);
      }

      return cb(null, player_data);
    });
  })
}

//////////


function save_user(player, cb) {

  cb = cb || function() {};

  uuid(function(err, uuid) {

    player.uuid = uuid;

    new db.players(player).save(function(err, _player) {
      if (err) {
        return cb({
          err,
          status: 500
        });
      }

      return cb(null, _player);
    })
  })
}

module.exports = add;
