//
//
//

const db = require('db');
const Game = require('core/game');

function start(game_uuid, cb) {

  cb = cb || function() {};

  if (!game_uuid) {
    return cb({
      status: 400,
      err: new Error('low args')
    });
  }

  let query = {
    uuid: game_uuid
  };

  db
    .games
    .findOne(query)
    .lean()
    .exec(function(err, game) {
      if (err) {
        return cb({
          status: 500,
          err: err
        });
      }

      if (!game) {
        return cb({
          status: 404,
          err: new Error('game not found!')
        })
      }

      // FIXME number of fighters should come from game init
      if (!game.fighter || game.fighter.length != 2) {
        // FIXME
        // this is when a game fighter are not ok!
      }

      // FIXME game can start again if turn_user == 0 and its a BUG
      if (game.turn_user) {
        return cb({
          status: 400,
          err: new Error('game is started and can\'t start again!')
        })
      }

      // choose first player
      // Game.choose_first_player(game_uuid, function(err) {
      //   if (err) {
      //     console.open(err.err.message);
      //     cb(err);
      //   }

      return cb(null, true);
      // });
    })
}

module.exports = start;
