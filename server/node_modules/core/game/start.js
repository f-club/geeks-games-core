//
//
//

const db = require('db');
const Game = require('core/game');

function start(uuid, cb) {

  cb = cb || function() {};

  if (!uuid) {
    return cb({
      status: 400,
      err: new Error('low args')
    });
  }

  let query = {
    uuid
  };

  db
    .games
    .findOne(query)
    .lean()
    .exec(function(err, game) {
      if (err) {
        return cb({
          status: 500,
          err: err
        });
      }

      if (!game) {
        return cb({
          status: 404,
          err: new Error('game not found!')
        })
      }

      // FIXME number of players should come from game init
      if (!game.fighter || game.fighter.length != 2) {
        // FIXME
        // this is when a game players are not ok!
      }

      // FIXME game can start again if turn_user == 0 and its a BUG
      if (game.turn_user) {
        return cb({
          status: 400,
          err: new Error('game is started and can\'t start again!')
        })
      }

      return cb(null, true);
    })
}

module.exports = start;
