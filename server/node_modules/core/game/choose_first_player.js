//
//
//

const db = require('db');

function choose(game_uuid, cb) {

  cb = cb || function() {};

  let query = {
    uuid: game_uuid
  }

  db.games.findOne(query, {
    fighters: true,
    turn_user: true
  }).lean().exec(function(err, game) {

    console.open(game);

    if (err) {
      return cb({
        status: 500,
        err: err
      })
    }

    if (!game || !game.fighters || !game.fighters.length) {
      return cb({
        status: 404,
        err: new Error('not found game or gamers!')
      })
    }

    if (game.turn_user) {
      return cb({
        status: 400,
        err: new Error('game is started and cant start again!')
      })
    }

    db.games.update(query, {
      $set: {
        turn_user: Math.floor(Math.random() * game.fighters.length)
      }
    }, function(err) {

      if (err) {
        return cb({
          status: 500,
          err: err
        })
      }

      console.log("ddd");
    })
  })
}

module.exports = choose;
